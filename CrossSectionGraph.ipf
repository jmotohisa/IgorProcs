#pragma rtGlobals=1		// Use modern global access method.#include <Cross Hair Cursors>Proc CopyMatWaveIxtoDisplayedWave()	$theTempYwave[] = $theImageName_T[p][xpos]	xvalue=DimOffset($theImageName, 0) + xpos *DimDelta($theImageName,0)EndProc CopyMatWaveIytoDisplayedWave()	$theTempXwave[] = $theImageName[p][ypos]|	$theTempYwave[] = $theImageName[xpos][q]	yvalue=DimOffset($theImageName, 1) + ypos *DimDelta($theImageName,1)EndMacro InitCrossSectionGraph(ImageName,GraphName,TempXwave,TempYwave)	String ImageName,GraphName,TempXwave="tempx",TempYwave="tempy",	Prompt ImageName,"Matrix Wave Name",popup,ImageNameList("",";")	Prompt GraphName,"Graph Name",popup,WinList("*",";","WIN:1")	Silent 1;PauseUpdate		String/G theImageName=ImageName,theImageName_T=ImageName+"_t"	String/G theGraphName=GraphName	String/G theTempXwave=TempXwave,theTempYwave=TempYwave	Variable/G xpos=0,ypos=0,xvalue,yvalue	String ImageName_T=theImageName_T	Variable nrs=DimSize($ImageName,0),ncs=DimSize($ImageName,1)	Duplicate/O $ImageName,$ImageName_T	MatrixTranspose $ImageName_T	Make/O/N=(nrs) $TempXwave	CopyScales $ImageName,$TempXwave	Make/O/N=(ncs) $TempYwave	CopyScales $ImageName_T,$TempYwave|	DispCrossSectionControl()	DispCrossSectionGraph()	CopyMatWaveIxtoDisplayedWave()	CopyMatWaveIytoDisplayedWave()End ProcFunction DispCrossSectionControl()|	NVAR xvalue=xvalue|	NVAR yvalue=yvalue	SVAR theImageName=theImageName		NewPanel /W=(561,285,889,371)	SetVariable setvar0,pos={9,14},size={117,15},proc=SetXValueProc,title="x posision"	SetVariable setvar0,limits={0,Inf,1},value= xpos	SetVariable setvar1,pos={9,32},size={117,15},proc=SetYValueProc,title="y posision"	SetVariable setvar1,limits={0,Inf,1},value= ypos	ValDisplay valdisp0,pos={134,14},size={124,15},title="x value"	ValDisplay valdisp0,limits={0,0,0},barmisc={0,1000},value= #"xvalue"	ValDisplay valdisp1,pos={134,32},size={124,15},title="y value"	ValDisplay valdisp1,limits={0,0,0},barmisc={0,1000},value= #"yvalue"	Button button0,pos={271,28},size={78,20},proc=MoveToCursolAButtonProc,title="Cursol A"	Button button1,pos={359,28},size={78,20},proc=MoveToCursolBButtonProc,title="Cursol B"	ValDisplay valdisp2,pos={286,7},size={72,15},limits={0,0,0},barmisc={0,1000}	ValDisplay valdisp2,value= #"theImageName"EndProc DispCrossSectionGraph()	PauseUpdate; Silent 1		Display /W=(519,44,998,505) $theTempXwave	AppendToGraph/L=left2/B=bottom2 $theTempYWave	ModifyGraph lblPos(left)=50,lblPos(bottom)=42	ModifyGraph freePos(left2)=0	ModifyGraph freePos(bottom2)={0,left2}	ModifyGraph axisEnab(left)={0,0.45}	ModifyGraph axisEnab(left2)={0.55,1}	ModifyGraph lblPos(left2)=50,lblPos(bottom2)=42	ShowInfo	ControlBar 54	SetVariable setvar0,pos={9,14},size={117,15},proc=SetXValueProc,title="x posision"	SetVariable setvar0,limits={0,Inf,1},value= xpos	SetVariable setvar1,pos={9,32},size={117,15},proc=SetYValueProc,title="y posision"	SetVariable setvar1,limits={0,Inf,1},value= ypos	ValDisplay valdisp0,pos={134,14},size={124,15},title="x value"	ValDisplay valdisp0,limits={0,0,0},barmisc={0,1000},value= #"xvalue"	ValDisplay valdisp1,pos={134,32},size={124,15},title="y value"	ValDisplay valdisp1,limits={0,0,0},barmisc={0,1000},value= #"yvalue"	Button button0,pos={271,28},size={78,20},proc=MoveToCursolAButtonProc,title="Cursol A"	Button button1,pos={359,28},size={78,20},proc=MoveToCursolBButtonProc,title="Cursol B"	SetVariable valdisp2,pos={286,7},size={144,15},title="Image Name"	SetVariable valdisp2,limits={0,0,0},value= theImageNameEndFunction SetXValueProc(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	|	NVAR xpos=xpos|	NVAR ypos=ypos	|	xpos=varNum|	ypos=varNum	Execute "CopyMatWaveIxtoDisplayedWave()"EndFunction SetYValueProc(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName|	NVAR xpos=xpos|	NVAR ypos=ypos	|	xpos=varNum|	ypos=varNum		Execute "CopyMatWaveIytoDisplayedWave()"EndFunction MoveToCursolAButtonProc(ctrlName) : ButtonControl	String ctrlName	NVAR xpos=xpos	NVAR ypos=ypos	SVAR theTempXwave=theTempXwave	SVAR theTempYwave=theTempYwave		String wvnm,csrname="A"	wvnm=CsrWave($csrname)	if(cmpstr(wvnm,theTempXwave)==0)		xpos=pcsr($csrname)		Execute "CopyMatWaveIytoDisplayedWave()"	else if(cmpstr(wvnm,theTempYwave)==0)		ypos=pcsr($csrname)		Execute "CopyMatWaveIxtoDisplayedWave()"	endifEndFunction MoveToCursolBButtonProc(ctrlName) : ButtonControl	String ctrlName	NVAR xpos=xpos	NVAR ypos=ypos	SVAR theTempXwave=theTempXwave	SVAR theTempYwave=theTempYwave		String wvnm,csrname="B"	wvnm=CsrWave($csrname)	if(cmpstr(wvnm,theTempXwave)==0)		xpos=pcsr($csrname)		Execute "CopyMatWaveIytoDisplayedWave()"	else if(cmpstr(wvnm,theTempYwave)==0)		ypos=pcsr($csrname)		Execute "CopyMatWaveIxtoDisplayedWave()"	endifEndFunction DisplayXcrossSection()	NVAR xvalue=xvalue	NVAR xpos=xpos	SVAR theImageName=theImageName	String df = "root:WinGlobals:"+WinName(0, 1)+":X0"	xvalue=NumVarOrDefault(df,0)	xpos=floor((xvalue - DimOffset($theImageName, 0))/DimDelta($theImageName,0)+0.5)|	print df,xvalue,xpos	Execute "CopyMatWaveIxtoDisplayedWave()"EndFunction DisplayYcrossSection()	NVAR yvalue=yvalue	NVAR ypos=ypos	SVAR theImageName=theImageName	String df = "root:WinGlobals:"+WinName(0, 1)+":Y0"	yvalue=NumVarOrDefault(df,0)	ypos=floor((yvalue - DimOffset($theImageName, 1))/DimDelta($theImageName,1)+0.5)|	print df,yvalue,ypos	Execute "CopyMatWaveIytoDisplayedWave()"End