#include <Strings as Lists>Macro InitLoadHP(startindex)	variable startindex	Silent 1; PauseUpDate		Variable/G g_startIndex	String/G g_hdr1,g_hdr2,g_hdr3,g_hdr4,g_hdr5	Variable/G g_x1min,g_x1max,g_x1step,g_x2min,g_x2max,g_x2step	Variable/G g_nsweep,g_ndata,g_numclmn,g_nhdr	g_startindex = startindex	Make/T/O w_tmpwnmsEndMacro LoadAllHPData(pathName,col1name,col2name,col3flag,col3name)	String pathName=""	String col1name="Vd"	Variable col3flag=3	String col2name="Id",col3name="Ig"	Prompt pathName,"Path Name"	Prompt col1name,"Source1 name",popup,"Vg;Vd"	Prompt col2name,"1st data name"	Prompt col3flag,"2nd data ?",popup,"yes;yes_but_skip;no"	Prompt col3name,"2nd data name"		Silent 1; PauseUpDate		String fileName|	String w0,Vg,w2,w3,w4,Id	Variable index=g_startindex		if(strlen(pathName)==0)		NewPath/O temporaryPath		pathName = "temporaryPath"	endif	print col3flag		do		fileName = IndexedFile($pathName, index,"TEXT")		if(strlen(fileName)==0)			break		endif		LoadHPData(fileName,pathName,col1name,col2name,col3flag,col3name,index)|		if(strlen(S_waveNames)>0)|		endif		index = g_startindex	while(1)		if(Exists("temporaryPath"))		KillPath temporaryPath	endifEndMacro LoadHPData(fileName,pathName,col1name,col2name,col3flag,col3name,startindex)	String fileName	String pathName="home"	String col1name="Vd"	Variable col3flag=3,startindex=g_startIndex	String col2name="Id",col3name="Ig"	Prompt fileName,"File Name"	Prompt pathName,"Path Name"	Prompt col1name,"Source1 name",popup,"Vg;Vd"	Prompt col2name,"1st data name"	Prompt col3flag,"2nd data ?",popup,"yes;yes_but_skip;no"	Prompt col3name,"2nd data name"	Prompt startindex,"starting index"		Silent 1; PauseUpDate		String w0,Vout,Id,w1,w2,w3,message	Variable ndata,nsweep=1	Variable index0=0,nskip	Variable ref,nsp	Variable/D x1min,x1max,x1step,x2min,x2max,x2step	|	NewPath pathNameP	|	ndata=ceil(abs((start1-stop1)/step1)+0.5)|	Print ndata		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif	print "Loading data from ",filename		Open/R/P=$pathName ref as fileName	FReadLine ref,message	FReadLine ref,message	print message		x1min = str2num(GetStrFromList(message,1," "))		x1max = str2num(GetStrFromList(message,3," "))		x1step = str2num(GetStrFromList(message,5," "))		ndata=ceil(abs((x1max-x1min)/x1step)+0.5)		print "ndata = ",ndata	FReadLine ref,message	nsp = countSpace(message)	if(nsp>4)		print message		x2min = str2num(GetStrFromList(message,1," "))		x2max = str2num(GetStrFromList(message,3," "))		x2step = str2num(GetStrFromList(message,5," "))		nsweep=ceil(abs((x2max-x2min)/x2step)+0.5)		print "nSweep= ",nsweep	endif	FReadLine ref,message	nsp = countSpace(message)	if(nsp==2)		col3flag=3|	else|		col3flag=1	endif	Close ref		nskip=5	do		if(col3flag==1)			LoadWave/G/D/A/L={0,nskip,ndata,1,3}/Q/P=$pathName fileName		else			LoadWave/G/D/A/L={0,nskip,ndata,1,2}/Q/P=$pathName fileName		endif		if(V_flag==0)			return		endif		|		w0 = GetStrFromList(S_waveNames,0,";")		Vout = GetStrFromList(S_waveNames,0,";")		id = GetStrFromList(S_waveNames,1,";")|		print w0,Vout,id		if(col3flag==1) then			w1 = GetStrFromList(S_waveNames,2,";")			Sort $Vout, $Vout, $Id, $w1			WaveStats/Q $Vout|			print "index = ", startindex, "V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id,$w1			w2 = col2name + num2istr(startindex)			w3 = col3name + num2istr(startindex)			Rename $Id,$w2			Rename $w1,$w3		else			Sort $Vout, $Vout, $Id			WaveStats/Q $Vout|			print "index = ", startindex,"V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id			w2 = col2name + num2istr(startindex)			Rename $Id,$w2		endif|		KillWaves $w0		KillWaves $Vout			index0 += 1		startindex +=1		nskip +=ndata|		Display $w7	while(index0<nsweep)		g_startindex=startindexEndMacro LoadHPData2(fileName,pathName,col1name,col2name,col3flag,col3name,startindex)| scale with (Vg1+Vg2)/2	String fileName	String pathName="home"	String col1name="Vd"	Variable col3flag=3,startindex=g_startIndex	String col2name="Id",col3name="Ig"	Prompt fileName,"File Name"	Prompt pathName,"Path Name"	Prompt col1name,"Source1 name",popup,"Vg;Vd"	Prompt col2name,"1st data name"	Prompt col3flag,"2nd data ?",popup,"yes;yes_but_skip;no"	Prompt col3name,"2nd data name"	Prompt startindex,"starting index"		Silent 1; PauseUpDate		String w0,Vout,Id,w1,w2,w3,message	Variable ndata,nsweep=1	Variable index0=0,nskip	Variable ref,nsp	Variable/D x1min,x1max,x1step,x2min,x2max,x2step	Variable/D Vg1,Vg2,vmax,vmin	|	NewPath pathNameP	|	ndata=ceil(abs((start1-stop1)/step1)+0.5)|	Print ndata		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif	print "Loading data from ",filename		Open/R/P=$pathName ref as fileName	FReadLine ref,message	FReadLine ref,message	print message		x1min = str2num(GetStrFromList(message,1," "))		x1max = str2num(GetStrFromList(message,3," "))		x1step = str2num(GetStrFromList(message,5," "))		ndata=ceil(abs((x1max-x1min)/x1step)+0.5)		print "ndata = ",ndata	FReadLine ref,message	nsp = countSpace(message)	if(nsp>4)		print message		x2min = str2num(GetStrFromList(message,1," "))		x2max = str2num(GetStrFromList(message,3," "))		x2step = str2num(GetStrFromList(message,5," "))		nsweep=ceil(abs((x2max-x2min)/x2step)+0.5)		print "nSweep= ",nsweep	endif	FReadLine ref,message	nsp = countSpace(message)	if(nsp==2)		col3flag=3|	else|		col3flag=1	endif	Close ref		nskip=5	do		if(col3flag==1)			LoadWave/G/D/A/L={0,nskip,ndata,1,3}/Q/P=$pathName fileName		else			LoadWave/G/D/A/L={0,nskip,ndata,1,2}/Q/P=$pathName fileName		endif		if(V_flag==0)			return		endif				Vg2 = x2min+x2step*index0		|		w0 = GetStrFromList(S_waveNames,0,";")		Vout = GetStrFromList(S_waveNames,0,";")		id = GetStrFromList(S_waveNames,1,";")|		print w0,Vout,id		if(col3flag==1) then			w1 = GetStrFromList(S_waveNames,2,";")			Sort $Vout, $Vout, $Id, $w1			WaveStats/Q $Vout|			print "index = ", startindex, "V_min =",V_min,"V_max =",V_max			vmin=(V_min+Vg2)/2			vmax=(V_max+Vg2)/2|			print vmin,vmax			SetScale/I x,Vmin,Vmax,"V",$Id,$w1			w2 = col2name + num2istr(startindex)			w3 = col3name + num2istr(startindex)			Rename $Id,$w2			Rename $w1,$w3		else			Sort $Vout, $Vout, $Id			WaveStats/Q $Vout|			print "index = ", startindex,"V_min =",V_min,"V_max =",V_max			vmin=(V_min+Vg2)/2			vmax=(V_max+Vg2)/2|			print vmin,vmax			SetScale/I x,Vmin,Vmax,"V",$Id			w2 = col2name + num2istr(startindex)			Rename $Id,$w2		endif|		KillWaves $w0		KillWaves $Vout			index0 += 1		startindex +=1		nskip +=ndata|		Display $w7	while(index0<nsweep)		g_startindex=startindexEndMacro LoadHPData_orig(fileName,pathName,col1name,ndata,nsweep,col2name,col3flag,col3name,startindex)	String fileName	String pathName="home"	String col1name="Vd"	Variable ndata,col3flag=3,startindex=0,nsweep=1	String col2name="Id",col3name="Ig"	Prompt fileName,"File Name"	Prompt pathName,"Path Name"	Prompt col1name,"Source1 name",popup,"Vg;Vd"	Prompt ndata,"no. of data for each sweep"	Prompt nsweep,"no. of sweep"	Prompt col2name,"1st data name"	Prompt col3flag,"2nd data ?",popup,"yes;yes_but_skip;no"	Prompt col3name,"2nd data name"	Prompt startindex,"starting index"		Silent 1; PauseUpDate		String w0,Vout,Id,w1,w2,w3,message	Variable index0=0,nskip	Variable ref|	NewPath pathNameP	|	ndata=ceil(abs((start1-stop1)/step1)+0.5)|	Print ndata		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif			nskip=5	do		if(col3flag==1)			LoadWave/G/D/A/L={0,nskip,ndata,1,3}/Q/P=$pathName fileName		else			LoadWave/G/D/A/L={0,nskip,ndata,1,2}/Q/P=$pathName fileName		endif		if(V_flag==0)			return		endif		|		w0 = GetStrFromList(S_waveNames,0,";")		Vout = GetStrFromList(S_waveNames,0,";")		id = GetStrFromList(S_waveNames,1,";")|		print w0,Vout,id		if(col3flag==1) then			w1 = GetStrFromList(S_waveNames,2,";")			Sort $Vout, $Vout, $Id, $w1			WaveStats/Q $Vout			print "index = ", startindex, "V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id,$w1			w2 = col2name + num2istr(startindex)			w3 = col3name + num2istr(startindex)			Rename $Id,$w2			Rename $w1,$w3		else			Sort $Vout, $Vout, $Id			WaveStats/Q $Vout			print "index = ", startindex,"V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id			w2 = col2name + num2istr(startindex)			Rename $Id,$w2		endif|		KillWaves $w0		KillWaves $Vout			index0 += 1		startindex +=1		nskip +=ndata|		Display $w7	while(index0<nsweep)EndMacro LoadHPData3(fileName,pathName,index,waveName)	String fileName	String pathName	String waveName	Variable index		Silent 1; PauseUpDate		String w0,w1,w2,w3		LoadWave/G/D/A/W/P=$pathName fileName	if(V_flag==0)		return	endif		w0 = GetStrFromList(S_waveNames,0,";")	w1 = GetStrFromList(S_waveNames,1,";")	w2 = GetStrFromList(S_waveNames,2,";")		KillWaves $w0	Sort $w1, $w1, $w2	WaveStats/Q $w1	SetScale/I x,V_min,V_max,"V",$w2|	SetScale y,0,1,"I",$Id	KillWaves $w1	w3 = waveName + num2istr(index)	Rename $w2,$w3|	Display $w3EndMacro LoadHPData4(fileName,pathName,index,waveName)	String fileName	String pathName	String waveName	Variable index		Silent 1; PauseUpDate		String w0,w1,w2,w3,w4		LoadWave/G/D/A/W/P=$pathName fileName	if(V_flag==0)		return	endif		w0 = GetStrFromList(S_waveNames,0,";")	w1 = GetStrFromList(S_waveNames,1,";")	w2 = GetStrFromList(S_waveNames,2,";")	w3 = GetStrFromList(S_waveNames,3,";")		KillWaves $w0,$w3	Sort $w1, $w1, $w2	WaveStats/Q $w1	SetScale/I x,V_min,V_max,"V",$w2|	SetScale y,0,1,"I",$Id	KillWaves $w1	w4 = waveName + num2istr(index)	Rename $w2,$w4|	Display $w4EndMacro LoadAllHPData34(pathName,waveName,col3flag)	String pathName="",waveName="Id"	Variable col3flag=1	Prompt pathName,"Path Name"	Prompt waveName,"data name"	Prompt col3flag,"2nd data ?",popup,"yes;yes_but_skip;no"			Silent 1; PauseUpDate		String fileName|	String w0,Vg,w2,w3,w4,Id	Variable index=0		if(strlen(pathName)==0)		NewPath/O temporaryPath		PathName = "temporaryPath"	endif	print col3flag		do		fileName = IndexedFile($pathName, index,"TEXT")		if(strlen(fileName)==0)			break		endif		if(col3flag==3) then			LoadHPdata3(fileName,pathName,index,waveName)		else			LoadHPData4(fileName,pathName,index,waveName)		endif|		if(strlen(S_waveNames)>0)|		endif		index +=1	while(1)		if(Exists("temporaryPath"))		KillPath temporaryPath	endifEndFunction countSpace(str)	String str	Variable nsp=0,psp=0		do		psp=strsearch(str," ",psp)		if(psp<0)			break		endif		psp+=1		nsp +=1	while(1)	return nspendFunction countDelim(str,delim)	String str,delim	Variable nsp=0,psp=0		do		psp=strsearch(str,delim,psp)		if(psp<0)			break		endif		psp+=1		nsp +=1	while(1)	return nspend| load data into matrix| only for Igor v3. and overMacro LoadHPData3D(fileName,pathName,targetName,startindex)	String fileName	String pathName="home"	String targetName="sample"	Variable col3flag=3,startindex=g_startIndex	Prompt fileName,"File Name"	Prompt pathName,"Path Name"	Prompt targetName,"target wave name"	Prompt startindex,"starting index"		Silent 1; PauseUpDate		String w0,Vout,Id,w1,w2,w3,message	Variable ndata,nsweep=1	Variable index0=0,nskip	Variable ref,nsp	Variable/D x1min,x1max,x1step,x2min,x2max,x2step	|	NewPath pathNameP	|	ndata=ceil(abs((start1-stop1)/step1)+0.5)|	Print ndata		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif	print "Loading data from ",filename		Open/R/P=$pathName ref as fileName	FReadLine ref,message	FReadLine ref,message	print message		x1min = str2num(GetStrFromList(message,1," "))		x1max = str2num(GetStrFromList(message,3," "))		x1step = str2num(GetStrFromList(message,5," "))		ndata=ceil(abs((x1max-x1min)/x1step)+0.5)		print "ndata = ",ndata	FReadLine ref,message	nsp = countSpace(message)	if(nsp>4)		print message		x2min = str2num(GetStrFromList(message,1," "))		x2max = str2num(GetStrFromList(message,3," "))		x2step = str2num(GetStrFromList(message,5," "))		nsweep=ceil(abs((x2max-x2min)/x2step)+0.5)		print "nSweep= ",nsweep	endif	FReadLine ref,message	nsp = countSpace(message)	if(nsp==2)		col3flag=3|	else|		col3flag=1	endif	Close ref		Make/O/N=(ndata,nsweep) $targetName		nskip=5	do		if(col3flag==1)			LoadWave/G/D/A/L={0,nskip,ndata,1,3}/Q/P=$pathName fileName		else			LoadWave/G/D/A/L={0,nskip,ndata,1,2}/Q/P=$pathName fileName		endif		if(V_flag==0)			return		endif		|		w0 = GetStrFromList(S_waveNames,0,";")		Vout = GetStrFromList(S_waveNames,0,";")		id = GetStrFromList(S_waveNames,1,";")|		print w0,Vout,id		if(col3flag==1) then			w1 = GetStrFromList(S_waveNames,2,";")			Sort $Vout, $Vout, $Id, $w1			WaveStats/Q $Vout|			print "index = ", startindex, "V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id,$w1			w2 = col2name + num2istr(startindex)			w3 = col3name + num2istr(startindex)			Rename $Id,$w2			Rename $w1,$w3		else			Sort $Vout, $Vout, $Id			WaveStats/Q $Vout|			print "index = ", startindex,"V_min =",V_min,"V_max =",V_max			SetScale/I x,V_min,V_max,"V",$Id			w2 = "tmp" + num2istr(startindex)			Rename $Id,$w2		endif|		KillWaves $w0		KillWaves $Vout		print w2		$targetName[][index0] = $w2[p]			index0 += 1		startindex +=1		nskip +=ndata|		Display $w7	while(index0<nsweep)			g_startindex=startindexEndMacro LoadHPdataG(filename,pathName,delim,startindex)	Variable startindex=g_startindex	String fileName	String pathName="home"	String delim="\t"	Prompt fileName,"File Name"	Prompt pathName,"Path Name"	Prompt delim,"delimitor"	Prompt startindex,"starting index"		PauseUpdate;Silent 1		Variable index=0,index2=0,ref,nskip	String wvnm,wvnm2		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif	print "Loading data from ",filename	ReadHPdataHeader(filename,pathname,delim)		index2=0	nskip=g_nhdr	do		LoadWave/G/D/A/L={0,nskip,g_ndata,1,g_numclmn}/Q/P=$pathName fileName		index=0		do			wvnm=GetStrFromList(S_waveNames,index,";")			wvnm2=w_tmpwnms[index]+"_"+num2istr(startindex)+"_"+num2istr(index2)			Rename $wvnm,$wvnm2			SetScale/I x,g_x1min,g_x1max,"",$wvnm2			index+=1			if(index >=g_numclmn)				break			endif		while(1)		index2+=1		nskip+=g_ndata		if(index2>=g_nSweep)			break		endif	while(1)End MacroMacro ReadHPdataHeader(filename,pathname,delim)	String filename,pathname="home",delim="\t"	Prompt fileName,"File Name"	Prompt pathName,"Path Name"		PauseUpdate;Silent 1		Variable ref	String str,str0,wnms		if (strlen(fileName)<=0)		Open /D/R/P=$pathName/T="sGBWTEXT" ref		fileName= S_fileName	endif		Open/R/P=$pathName ref as fileName	FReadLine ref, g_hdr1	FReadLine ref, g_hdr2	FReadLine ref, g_hdr3	FReadLine ref, g_hdr4	FReadLine ref, g_hdr5	Close ref	print chop(g_hdr1)	print chop(g_hdr2)	g_x1min = str2num(GetStrFromList(g_hdr2,1,delim))	g_x1max = str2num(GetStrFromList(g_hdr2,3,delim))	str0=GetStrFromList(g_hdr2,5,delim)	if(stringmatch(str0,"LOG")==1)		g_x1step=0		g_ndata=0	else		g_x1step = str2num(str0)		g_ndata=ceil(abs((g_x1max-g_x1min)/g_x1step)+0.5)	endif	print "ndata = ",g_ndata		str=GetStrFromList(g_hdr3,0,delim)	if(strsearch(str,"NO",0)==0)		g_nhdr=4		wnms=g_hdr3		g_nsweep=1		SetColumnNames(wnms,delim)	else		print chop(g_hdr3)		g_nhdr=5		wnms=g_hdr4		g_x2min = str2num(GetStrFromList(g_hdr3,1,delim))		g_x2max = str2num(GetStrFromList(g_hdr3,3,delim))		str0=GetStrFromList(g_hdr3,5,delim)		if(stringmatch(str0,"LOG")==1)			g_x2step=0			g_nsweep=1		else			g_x2step = str2num(str0)			g_nsweep=ceil(abs((g_x2max-g_x2min)/g_x2step)+0.5)		endif		print "nSweep= ",g_nsweep	endif	SetColumnNames(chop(wnms),delim)End MacroMacro SetColumnNames(wnms,delim)	String wnms,delim	PauseUpdate;Silent 1		Variable index=1	String wname	do		wname=GetStrFromList(wnms,index,delim)		if(StrLen(wname)==0)			break		endif		w_tmpwnms[index-1] = wname		index+=1	while(1)	g_numclmn=index-1End MacroFunction/S chop(str)	String str	String str2	Variable len	len=StrLen(str)	if(char2num(str[len-1,len])==13)		str2=str[0,len-2]	else		str2=str	endif	return str2end