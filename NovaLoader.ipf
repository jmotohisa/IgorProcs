#pragma rtGlobals=1		// Use modern global access method.#include "MatrixOperations2"// Load densdata file// with file format conversion "ddconv_igor.pl"// requires Mac OS X, AppleScript and "system OSAX"Macro LoadDensData(waveName,filename,pathname,dataname)	String waveName,fileName,pathName="home",dataname="dens"		Silent 1;PauseUpdate	Variable ref,deltax,nItem	String w0,buffer	String st,fileNameTemp		if (strlen(fileName)<=0)		Open /D/R/P=$pathName ref		fileName= S_fileName	endif	print fileName	fileNameTemp=NewFileName(fileName,dataname+".dat")	print fileNameTemp	// Execute AppleScript to convert densdata	st=""//	st="set perlpath to \"/usr/local/bin/perl\"\r"//	st=st+"set ScriptPath to \"/Users/motohisa/current/nova/ddconv_igor.pl\""+"\r"	st=st+"set myFile to \""+fileName+"\" as file specification\r"	st=st+"set myTempFile to \""+fileNameTemp+"\" as file specification\r"	st=st+"set fh to open for access myTempFile\r"	st=st+"close access fh\r"	st=st+"tell application \"Finder\""+"\r"	st=st+"set fullPosixPath to posixPath myFile with quotes\r"	st=st+"set fullPosixPathTemp to posixPath myTempFile with quotes\r"	st=st+"set aCmd to \"/usr/local/bin/perl /Users/motohisa/current/nova/ddconv_igor.pl \""	st=st+" & fullPosixPath  & \" > \" & fullPosixPathTemp"+"\r"	st=st+"set aResult to (system aCmd)\r"	st=st+"End tell"//	print st,strlen(st)// execute	ExecuteScriptText st// load data	LoadMatrixWave(waveName,fileNameTemp,pathName,1,1,1)End MacroFunction/S NewFileName(source,newname)	String source,newname	String tempname	Variable nItem,length	nItem = ItemsInList(source,":")	tempname=AddListItem(newname,RemoveListItem(nItem-1,source,":"),":",Inf)	length=strlen(tempname)	return tempname[0,length-2]End