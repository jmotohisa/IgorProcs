#pragma TextEncoding = "MacRoman"#pragma rtGlobals=1		// Use modern global access method.// MultipleY.ipf// version 0.1// by J. Motohisa//	revision history//		97/09/02	ver 0.1	first version//		00/07/09	ver 0.2	first stable release//		04/08/21 -04/08/29	ver 0.3 modified to be compatible with xy waves//// #include <Strings as Lists> // no more neccessary after Igor Pro 3?#include "ColorWave"#include "JMprocs"Macro DefineGrobal()	String/G g_graphname	String/G g_stdwave	String/G g_origWaveList	String/G g_dstwave	Variable/G g_ymin,g_ymax,g_offsetEndMacroMacro InitMultiYaxesGraph(grname,swave)// initialization for multiple y-axes	String grname=WinName(0, 1),swave=WaveName("",0,1)//	String gnewname="multiYaxes"	Prompt grname,"Graph to create multiple axes",popup,WinList("*",";","WIN:1")	Prompt swave,"Wave name for the standard axis",popup,WaveList("*",";","WIN:"+grname)//	Prompt swave,"Wave name for the standard axis",popup,WaveList("*",";","WIN:"+grname)//	Prompt gnewname,"New graph name"	PauseUpdate; Silent 1		g_graphname=grname	g_stdwave=swave	g_origWaveList=TraceNameList(grname,";",1)EndMacro//Macro MakeMultiYaxesGraph(grname,swave,gnewname,axisflag,flag)Macro MakeMultiYaxesGraph(swave,gnewname,axisflag,flag)// Display new graph as multiple y-axes//	String grname=g_graphname,swave=g_stdwave	String swave=g_stdwave	String gnewname="multiYaxes"	Variable axisflag=1,flag=2//	Prompt grname,"Graph to create multiple axes",popup,WinList("*",";","WIN:1")	Prompt swave,"Wave name for the standard axis",popup,g_origWaveList//	Prompt swave,"Wave name for the standard axis",popup,g_stdwave+WaveList("*",";","*")	Prompt gnewname,"New graph name"	Prompt axisflag,"y-axis scaling",popup,"automatic;all same as standard wave"	Prompt flag,"Delete orignal graph",popup,"yes;no"	PauseUpdate; Silent 1		Variable nplots=0,index=0,ymin,ymax	String grname=g_graphname	String origWaveList=g_origwavelist	String w0,yLabelName	string xwv	g_graphname=gnewname	g_stdwave=swave	g_origWaveList=origWaveList//	print swave//	Create new plots with multiple axes (title:multiYaxes)	xwv=XWaveName(grname,swave)	if(strlen(xwv)==0)		Display $swave	else		Display $swave vs $xwv	endif	GetAxis/Q Left;g_ymin=V_min;g_ymax=V_max	ymin=g_ymin;ymax=g_ymax	DoWindow/C $gnewname	do		w0=StringFromList(index,origWaveList,";")		if(strlen(w0)==0)			break		endif		if(cmpstr(w0,swave)!=0)			yLabelName="Left_"+num2istr(index)			xwv=XWaveName(w0,swave)			if(strlen(xwv)==0)				AppendToGraph/L=$yLabelName $w0			else				AppendToGraph/L=$yLabelName $w0 vs $xwv			endif//				AppendToGraph/L=$yLabelName $w0			ModifyGraph noLabel($yLabelName)=2,axThick($yLabelName)=0			ModifyGraph freePos($yLabelName)=0			if(axisflag==2)				SetAxis $yLabelName,ymin,ymax			Endif		Endif		index+=1	while(1)		ColorWaves()	if(flag==1)		DoWindow/K $grname	EndifEndMacroMacro ChangeToMultiYaxesGraph(grname,swave,twave,axisflag,flag)// Display new graph as multiple y-axes	String grname=g_graphname,swave=g_stdwave,twave=g_dstwave	Variable axisflag=1,flag=1	Prompt grname,"Graph name",popup,WinList("*",";","WIN:1")	Prompt swave,"Wave name for the standard axis",popup,WaveList("*",";","WIN:"+grname)	Prompt twave,"Wave name to scale",popup,WaveList("*",";","WIN:"+grname)	Prompt axisflag,"y-axis scaling",popup,"automatic;same as standard wave"	Prompt flag,"delete orignal trace",popup,"yes;no"	PauseUpdate; Silent 1		Variable index=0,ymin,ymax	String yLabelName,alist	g_graphname=grname	g_stdwave=swave	g_dstwave=twave	DoWindow/F $grname	alist=AxisList(grname)	GetAxis/Q left;g_ymin=V_min;g_ymax=V_max	ymin=g_ymin;ymax=g_ymax		if(flag==1)		RemoveFromGraph $twave	endif	do		yLabelName="Left_"+num2istr(index)		if(strsearch(alist, yLabelName, 0)==-1)			break		endif		index+=1	while(1)		AppendToGraph/L=$yLabelName $twave	ModifyGraph noLabel($yLabelName)=2,axThick($yLabelName)=0	ModifyGraph freePos($yLabelName)=0	if(axisflag==2)		SetAxis $yLabelName,ymin,ymax	endifEndMacroMacro ScaleAllinSame(grname,swave,ymin,ymax,offset,flag)	String grname=g_graphname,swave=g_stdwave	Variable ymin=g_ymin,ymax=g_ymax,flag=1,offset=g_offset	Prompt grname,"Graph name",popup,WinList("*",";","WIN:1")	Prompt swave,"Wave name for the standard axis",popup,WaveList("*",";","WIN:"+grname)	Prompt ymin,"y minimum"	Prompt ymax,"y maximum"	Prompt offset,"offset"	Prompt flag,"Create tag ?",popup,"yes;no"	Silent 1;PauseUpdate	Variable index,st,en,factor=1	String tagname,annon,twave	String wlist=TraceNameList(grname,";",1) //WaveList("*",";","WIN:"+grname)	g_graphname=grname	g_stdwave=swave	g_ymin=ymin;g_ymax=ymax	g_offset=offset		DoWindow/F $grname	SetAxis Left,ymin+offset,ymax+offset	do		twave=StringFromList(index,wlist,";")		if(strlen(twave)==0) 			break		endif		if(cmpstr(twave,swave)==0)			if(flag==1)				tagname="ftag"				annon="\[1\ON, \F'Symbol'´\]1 "+num2str(factor)				if(strsearch(AnnotationList(grname),tagname,0)<0)					Tag/N=$tagname/F=0/L=1 $twave,pnt2x($twave,0),annon				else					Tag/C/N=$tagname $twave,pnt2x($twave,0),annon				endif			endif		else			ScaleOneYWave(grname,swave,twave,factor,offset,flag)		endif		index+=1	while(1)EndMacro ScaleOneYWave(grname,swave,twave,factor,offset,flag)	String grname=g_graphname,swave=g_stdwave,twave=g_dstwave	Variable factor=1,flag=1,offset=g_offset	Prompt grname,"Graph name",popup,WinList("*",";","WIN:1")	Prompt swave,"Wave name for the standard axis",popup,WaveList("*",";","WIN:"+grname)	Prompt twave,"Wave name to scale",popup,WaveList("*",";","WIN:"+grname)	Prompt factor,"magnification factor"	Prompt offset,"offset"	Prompt flag,"Create tag ?",popup,"yes;no"	Silent 1;PauseUpdate	Variable ymin,ymax,index,st,en	String YAxis=YAxisOfWave(grname,twave,0),tagname,annon		g_graphname=grname	g_stdwave=swave	g_dstwave=twave	g_offset=offset		DoWindow/F $grname	GetAxis/Q left;ymin=(V_min-offset)/factor+offset;ymax=(V_max-offset)/factor+offset	SetAxis $YAxis,ymin,ymax	st=strlen("Left_");en=strlen(YAxis)	if(flag==1)		tagname="ftag"+YAxis[st,en-1]		annon="\[1\ON, \F'Symbol'´\]1"+num2str(factor)		if(strsearch(AnnotationList(grname),tagname,0)<0)			Tag/N=$tagname/F=0/L=1 $twave,pnt2x($twave,0),annon		else//			print tagname,twave,annon			Tag/C/N=$tagname $twave,pnt2x($twave,0),annon		endif	EndifEnd