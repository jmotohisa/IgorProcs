#pragma rtGlobals=1		// Use modern global access method.#include <Value Report>#include <strings as lists>#include "PickupCrsPt2"Macro InitLandau(grname,wavename)	String grname,wavename	Prompt grname,"Graph Name",popup,WinList("*", ";", "WIN:1")	Prompt wavename,"Xwave name",popup,WaveList("*",";","WIN:")	String ywave=XWaveOfWave(grname,waveName,0)	$ywave = 1/$ywave	sort $ywave,$ywave,$waveName	SetAxis bottom 0,2	InitPickupCsrPt(grname,"destx","desty","nameofx")End MacroMacro LandouPlot(wavename)	String wavename	Prompt wavename,"wave name",popup,WaveList("peak*",";","")|	Prompt wavename		Silent 1; PauseUpDate		Display $wavename	ModifyGraph mode=3,marker=19	ModifyGraph tick=2,mirror=1,standoff=0	WaveStats/Q $wavename	SetAxis left 0,V_max*1.2	SetAxis bottom -1,V_npnts+1End MacroMacro ScaleIndex(wavename,index)	String wavename	Variable index	Prompt wavename,"wave name",popup,WaveList("*",";","WIN:")|	Prompt index		Silent 1; PauseUpDate	WaveStats/Q $wavename		SetScale/P x index,1,"", $wavename	SetAxis bottom -1,(V_npnts+index)End MacroMacro LPfit(waveName,apflag,aflag)| fitting  by k0 + n*k1 = (n + ph) * a0 -> a0 = k1;ph = k0/k1	String waveName|	Variable k0flag=2	Variable aflag=1,apflag = 1	Prompt waveName,"wave name",popup,WaveList("*", ";", "WIN:")|	Prompt k0flag,"Set K0 to be 0",popup,"yes;no"	Prompt apflag,"Append as new fit results?",popup,"yes;no"	Prompt aflag,"Display Fit Results ?",popup,"yes;no"	Silent 1; PauseUpDate	| curve fit result a0+a1*exp(-t/tau1) + a2 * exp(-t/tau2)	String str_tau1, str_tau2,str_a0,str_a1,str_a2	String str_textbox,str_fitres="fitres",annonlist,str,str_ns	Variable/D a0,ph,Ns	Variable index = 0	annonlist = AnnotationList("")	do		str = str_fitres + num2istr(index)		if(strsearch(annonlist,str,0)<0)			break		endif		index +=1	while(1)	|	if(k0flag==1)|		K0=0		CurveFit line $wavename /D 		a0 = W_coef[1]		ph = W_coef[0]/W_coef[1]		Ns = 4.83e10/a0		str_a0 = MakeValueReportString(a0,0,0,"",1)		str_a1 = MakeValueReportString(ph,0,0,"",1)		str_ns = MakeValueReportString(Ns,0,0,"",1)		str_textbox = "file: " + wavename + "\r"		str_textbox = str_textbox + "(1/B)\Bpeak\M = a\B0\M (n + \F'Symbol'f\F'Helvetica')\r"		str_textbox = str_textbox + "a\B0\M = " + str_a0 + "\r"		str_textbox = str_textbox + "\F'Symbol'f\F'Helvetica' = " + str_a1 + "\r"		str_textbox = str_textbox + "N\Bs\M = " + str_ns|	endif|	Print "number of iteration is = "|,V_FitNumIters	if(apflag==1 %| index==0) then		Textbox/N=$str/F=0/A=MC/X=-32.88/Y=32.55 str_textbox	else		index -=1		str = str_fitres + num2istr(index)		Textbox/C/N=$str/F=0/A=MC/X=-32.88/Y=32.55 str_textbox	endif	if(aflag==1)		AppendFitResults(waveName,index)	endifEnd MacroMacro AppendFitResults(waveName,index)	String waveName	Variable index	Prompt waveName,"wave name",popup,WaveList("*", ";", "WIN:")		String wave2		wave2 = "fit0_" + num2istr(index) + "_"+ waveName	Duplicate/O $waveName,$wave2		WaveStats/Q $wavename|	SetAxis bottom -1,V_npnts	Redimension/N=(V_npnts+5) $wave2	SetScale/P x,-1,1,$wave2	$wave2 = W_coef[0] + W_coef[1] * x		if(strsearch(WaveList("*",";","WIN:"),wave2,0)<0) 		AppendToGraph $wave2		RemoveFromGraph $("fit_" + wavename)		ModifyGraph rgb($wave2)=(0,0,65535)	endifEnd MacroMacro afterpickup()	InitLandau(g_destwx)	LandouPlot(g_destwx)End MacroMacro ScaleIndex_pickup(index)	Variable index	ScaleIndex(g_destwx,index)End MacroMacro LPfit_pickup(apflag,aflag)	Variable aflag=1,apflag = 1	Prompt apflag,"Append as new fit results?",popup,"yes;no"	Prompt aflag,"Display Fit Results ?",popup,"yes;no"		LPfit(g_destwx,apflag,aflag)End Macro